{% extends "base.html" %}
{% block content %}
<h2 class="mb-3">Your Wallet</h2>
<div class="row g-3">
  <div class="col-lg-8">
    <div class="nok-card p-3 mb-3">
      <div class="row g-3">
        <div class="col-md-4">
          <div class="border rounded-4 p-3 h-100">
            <div class="small text-secondary">Z Coins</div>
            <div class="fw-semibold fs-5 text-success">{{ wallet.balance_z }} Z</div>
          </div>
        </div>
        <div class="col-md-4">
          <div class="border rounded-4 p-3 h-100">
            <div class="small text-secondary">UZS balance</div>
            <div class="fw-semibold fs-5">{{ wallet.balance_uzs }} so'm</div>
          </div>
        </div>
        <div class="col-md-4">
          <div class="border rounded-4 p-3 h-100">
            <div class="small text-secondary">Referral code</div>
            <div class="fw-semibold text-success">{{ request.user.referral_code }}</div>
            <small class="text-secondary">Share it – when friends buy Z Coins, you get bonus Z.</small>
          </div>
        </div>
      </div>
    </div>
    <div class="nok-card p-3">
      <h6 class="text-secondary mb-2">Recent transactions</h6>
      <div class="small" style="max-height: 260px; overflow-y:auto;">
        {% for tx in transactions %}
          <div class="d-flex justify-content-between border-bottom border-secondary py-1">
            <span>{{ tx.created_at|date:"Y-m-d H:i" }} · {{ tx.get_type_display }}</span>
            <span>
              {% if tx.amount_z %}{{ tx.amount_z }} Z{% endif %}
              {% if tx.amount_uzs %} ({{ tx.amount_uzs }} UZS){% endif %}
            </span>
          </div>
        {% empty %}
          <div class="text-secondary">No transactions yet.</div>
        {% endfor %}
      </div>
    </div>
  </div>
  <div class="col-lg-4">
    <div class="nok-card p-3 mb-3">
      <h6>Deposit UZS (simulate cards)</h6>
      <form method="post" class="small">
        {% csrf_token %}
        <input type="hidden" name="action" value="deposit">
        <div class="mb-2">
          <label class="form-label small">Amount in so'm</label>
          <input type="number" name="amount_uzs" class="form-control form-control-sm" placeholder="200000">
        </div>
        <button class="btn btn-success w-100 btn-sm">Deposit</button>
        <div class="form-text text-secondary">In production, connect HUMO/Uzcard/Visa here.</div>
      </form>
    </div>
    <div class="nok-card p-3 mb-3">
      <h6>Convert UZS → Z Coins</h6>
      <form method="post" class="small">
        {% csrf_token %}
        <input type="hidden" name="action" value="convert">
        <div class="mb-2">
          <label class="form-label small">UZS to convert</label>
          <input type="number" name="convert_uzs" class="form-control form-control-sm" placeholder="300000">
        </div>
        <button class="btn btn-outline-light w-100 btn-sm">Convert</button>
        <div class="form-text text-secondary">1 Z = 10 000 so'm</div>
      </form>
    </div>
    <div class="nok-card p-3">
      <h6>Withdraw Z → UZS</h6>
      <form method="post" class="small">
        {% csrf_token %}
        <input type="hidden" name="action" value="withdraw">
        <div class="mb-2">
          <label class="form-label small">Z coins to withdraw</label>
          <input type="number" name="withdraw_z" class="form-control form-control-sm" placeholder="50">
        </div>
        <button class="btn btn-danger w-100 btn-sm">Withdraw</button>
        <div class="form-text text-secondary">1% withdrawal fee. In production, connect your bank or payment provider.</div>
      </form>
    </div>
  </div>
</div>
{% endblock %}
